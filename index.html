
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>배드민턴 코트 배정</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f8ff; padding: 1em; }
    h2 { text-align: center; }
    textarea { width: 100%; height: 100px; font-size: 16px; margin-bottom: 1em; }
    .btn { width: 100%; padding: 12px; background-color: #007bff; color: white; font-size: 16px; border: none; border-radius: 8px; margin-bottom: 20px; cursor: pointer; }
    .layout { display: flex; flex-wrap: wrap; gap: 10px; justify-content: space-between; }
    .column { background: white; border: 2px solid #ccc; border-radius: 8px; padding: 10px; flex: 1; min-width: 200px; min-height: 150px; position: relative; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
    .reset-btn { background: #ff6666; color: white; border: none; padding: 4px 8px; border-radius: 5px; font-size: 12px; cursor: pointer; }
    .name-tag {
      font-size: 14px;
      font-weight: bold;
      padding: 8px 10px;
      line-height: 24px;
      min-height: 32px;
      display: inline-block;
      margin: 5px;
      border: 2px solid #444;
      border-radius: 6px;
      background: #ffffcc;
      position: relative;
    }
    .male { background-color: #cce5ff; border-color: #3399ff; }
    .female { background-color: #ffd6e8; border-color: #ff66b2; }
    .badge {
      position: absolute;
      top: -0.5em;
      left: -0.5em;
      background: #800020;
      color: white;
      font-size: 0.8em;
      width: 1.5em;
      height: 1.5em;
      line-height: 1.5em;
      border-radius: 50%;
      text-align: center;
      z-index: 10;
      cursor: pointer;
    }
    .sort-btns { display: flex; gap: 5px; margin-top: 5px; flex-wrap: wrap; }
    .layout { overflow-x: auto; }
    .namepool-row { display: flex; justify-content: center; margin-top: 20px; }
    #namePool { width: 95%; }
  </style>
</head>
<body>
<h2>배드민턴 코트 배정</h2>
<textarea id="inputArea" placeholder="이름 급수 성별 입력"></textarea>
<button class="btn" id="generateBtn">이름표 만들기</button>

<div class="layout" id="layout"></div>
<div class="namepool-row">
  <div class="column" id="namePool">
    <div class="header"><h4 style="font-size: 24px;">대기</h4></div>
    <div class="sort-btns">
      <button class="reset-btn" onclick="resetAll()">초기화</button>
      <button class="reset-btn" onclick="sortNamePool('급수정렬')">급수정렬</button>
      <button class="reset-btn" onclick="sortNamePool('횟수정렬')">횟수정렬</button>
    </div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC0caXzAibBt9caNKOnEwEzq3kEtKgABdw",
    authDomain: "cock-9ca00.firebaseapp.com",
    databaseURL: "https://cock-9ca00-default-rtdb.firebaseio.com",
    projectId: "cock-9ca00",
    storageBucket: "cock-9ca00.firebasestorage.app",
    messagingSenderId: "1097422224517",
    appId: "1:1097422224517:web:e103a3b4d57896fd627dec"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const layoutIds = ["wait1", "wait2", "court1", "court2", "court3", "court4"];
  const layout = document.getElementById("layout");
  layoutIds.forEach(id => {
    const div = document.createElement("div");
    div.className = "column";
    div.id = id;
    div.innerHTML = `<div class="header"><h4 style="font-size: 24px;">${id.replace('court','').replace('wait','대기 ')}</h4>
    <button class="reset-btn" onclick="resetColumn('${id}')">리셋</button></div><div class="sort-btns"></div>`;
    layout.appendChild(div);
  });

  function createTag(key, data) {
    const tag = document.createElement("div");
    tag.className = "name-tag";
    tag.dataset.key = key;
    tag.textContent = data.name + " " + data.level;
    tag.classList.add(data.gender === "남" ? "male" : "female");

    const badge = document.createElement("div");
    badge.className = "badge";
    badge.textContent = "0";
    tag.appendChild(badge);
    return tag;
  }

  window.generateTags = function () {
    const input = document.getElementById("inputArea").value.trim();
    const lines = input.split("\n");
    lines.forEach(line => {
      const parts = line.trim().split(" ");
      if (parts.length >= 3) {
        const name = parts[0];
        const level = parts[1];
        const gender = parts[2];
        const tag = createTag(name + Date.now(), { name, level, gender });
        document.getElementById("namePool").appendChild(tag);
      }
    });
    document.getElementById("inputArea").value = "";
    syncState();
  }

  document.getElementById("generateBtn").onclick = generateTags;

  function syncState() {
    const state = {};
    [...layoutIds, "namePool"].forEach(id => {
      const tags = Array.from(document.getElementById(id).querySelectorAll(".name-tag")).map(tag => ({
        text: tag.textContent.trim(),
        gender: tag.classList.contains("male") ? "남" : "여",
        badge: tag.querySelector(".badge")?.textContent || "0"
      }));
      state[id] = tags;
    });
    set(ref(db, "court-state"), state);
  }

  function applyState(state) {
    [...layoutIds, "namePool"].forEach(id => {
      const container = document.getElementById(id);
      container.innerHTML = "";
      state[id]?.forEach(data => {
        const [name, level] = data.text.split(" ");
        const tag = createTag(name + Math.random(), { name, level, gender: data.gender });
        tag.querySelector(".badge").textContent = data.badge;
        container.appendChild(tag);
      });
    });
  }

  onValue(ref(db, "court-state"), snapshot => {
    const state = snapshot.val();
    if (state) applyState(state);
  });

  window.resetColumn = function(id) {
    const col = document.getElementById(id);
    const pool = document.getElementById("namePool");
    col.querySelectorAll(".name-tag").forEach(tag => pool.appendChild(tag));
    syncState();
  }

  window.resetAll = function() {
    [...layoutIds, "namePool"].forEach(id => {
      document.getElementById(id).innerHTML = "";
    });
    syncState();
  }

  window.sortNamePool = function(type) {
    const pool = document.getElementById("namePool");
    const tags = Array.from(pool.querySelectorAll(".name-tag"));
    tags.sort((a, b) => {
      if (type === "급수정렬") {
        const order = { "S": 0, "A": 1, "B": 2, "C": 3, "D": 4 };
        const aLevel = a.textContent.trim().split(" ")[1]?.[0] || "";
        const bLevel = b.textContent.trim().split(" ")[1]?.[0] || "";
        return (order[aLevel] ?? 99) - (order[bLevel] ?? 99);
      }
      if (type === "횟수정렬") {
        const aCount = parseInt(a.querySelector(".badge")?.textContent || 0);
        const bCount = parseInt(b.querySelector(".badge")?.textContent || 0);
        return aCount - bCount;
      }
      return 0;
    });
    tags.forEach(tag => pool.appendChild(tag));
    syncState();
  }
</script>
</body>
</html>
