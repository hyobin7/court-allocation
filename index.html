
<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>배드민턴 코트 배정</title>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js">
function moveAll(fromId, toId) {
  const from = document.getElementById(fromId);
  const to = document.getElementById(toId);
  from.querySelectorAll('.name-tag').forEach(tag => to.appendChild(tag));
}

function resetAll() {
  const ids = ["wait1", "wait2", "court1", "court2", "court3", "court4", "namePool"];
  ids.forEach(id => {
    const col = document.getElementById(id);
    col.querySelectorAll(".name-tag").forEach(tag => tag.remove());
  });
}
</script>
<style>
    body { font-family: Arial, sans-serif; background: #f0f8ff; padding: 1em; }
    h2 { text-align: center; }
    textarea { width: 100%; height: 100px; font-size: 16px; margin-bottom: 1em; }
    .btn { width: 100%; padding: 12px; background-color: #007bff; color: white; font-size: 16px; border: none; border-radius: 8px; margin-bottom: 20px; cursor: pointer; }
    .layout { display: flex; flex-wrap: wrap; gap: 10px; justify-content: space-between; }
    .column { background: white; border: 2px solid #ccc; border-radius: 8px; padding: 10px; flex: 1; min-width: 200px; min-height: 150px; position: relative; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
    .reset-btn { background: #ff6666; color: white; border: none; padding: 4px 8px; border-radius: 5px; font-size: 12px; cursor: pointer; }
    .name-tag {
    font-size: 20px;
    padding: 10px 12px;
    line-height: 24px;
    min-height: 32px; display: inline-block; margin: 5px; padding: 8px 10px; border: 2px solid #444; border-radius: 6px; font-size: 14px; font-weight: bold; background: #ffffcc; position: relative; }
    .male { background-color: #cce5ff; border-color: #3399ff; }
    .female { background-color: #ffd6e8; border-color: #ff66b2; }
    


.badge {
  position: absolute;
  top: -0.5em;
  left: -0.5em;
  background: #800020;
  color: white;
  font-size: 0.8em;
  width: 1.5em;
  height: 1.5em;
  line-height: 1.5em;
  border-radius: 50%;
  text-align: center;
  z-index: 10;
  cursor: pointer;
}



    .sort-btns { display: flex; gap: 5px; margin-top: 5px; }
  
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: nowrap;
  gap: 10px;
}
.header h4 {
  margin: 0;
  white-space: nowrap;
}

.layout {
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  flex-wrap: nowrap;
  overflow-x: auto;
}
.layout > div {
  flex: 1 0 auto;
  margin: 5px;
}

.namepool-row {
  display: flex;
  justify-content: center;
  margin-top: 20px;
}
#namePool {
  width: 95%;
}

#wait1, #wait2 {
  flex: 0 0 16%;
  min-width: 180px;
}
#wait2 .sort-btns {
  display: flex;
  gap: 5px;
  margin-top: 5px;
}
#wait2 .sort-btns button {
  white-space: nowrap;
}

.name-tag 


.badge {
  position: absolute;
  top: -0.5em;
  left: -0.5em;
  background: #800020;
  color: white;
  font-size: 0.8em;
  width: 1.5em;
  height: 1.5em;
  line-height: 1.5em;
  border-radius: 50%;
  text-align: center;
  z-index: 10;
  cursor: pointer;
}



.name-tag {
    font-size: 20px;
    padding: 10px 12px;
    line-height: 24px;
    min-height: 32px;
  position: relative;
  padding-left: 10px;
  padding-top: 10px;
}


/* 모바일/패드: 1~4코트는 한 줄, 그 아래 대기1/2 한 줄 */
@media screen and (max-width: 1024px) {
  .layout {
    flex-wrap: wrap;
  }

  #court1, #court2, #court3, #court4 {
    order: 1;
    flex: 1 1 23%;
    min-width: 23%;
  }

  #wait1, #wait2 {
    order: 2;
    flex: 1 1 48%;
    min-width: 48%;
  }
}


/* 모바일에서 코트/대기 줄 구분 */
@media screen and (max-width: 1024px) {
  .mobile-court-row, .mobile-wait-row {
    display: flex;
    flex-wrap: nowrap;
    width: 100%;
    justify-content: space-between;
  }

  .mobile-court-row > div {
    flex: 0 0 24%;
    min-width: 24%;
  }

  .mobile-wait-row > div {
    flex: 0 0 49%;
    min-width: 49%;
  }
}


/* 기본: 모바일 전용 row 숨기기, 기존 구조 유지 */
.mobile-court-row,
.mobile-wait-row {
  display: none;
}

/* 모바일 전용: 줄 구분 구조 적용 */
@media screen and (max-width: 1024px) {
  .layout > #court1,
  .layout > #court2,
  .layout > #court3,
  .layout > #court4,
  .layout > #wait1,
  .layout > #wait2 {
    display: none !important;
  }

  .mobile-court-row,
  .mobile-wait-row {
    display: flex !important;
    flex-wrap: nowrap;
    width: 100%;
    justify-content: space-between;
  }

  .mobile-court-row > div {
    flex: 0 0 24%;
    min-width: 24%;
  }

  .mobile-wait-row > div {
    flex: 0 0 49%;
    min-width: 49%;
  }

  /* 버튼이 칸 밖으로 나가지 않도록 보정 */
  .mobile-court-row .sort-btns,
  .mobile-wait-row .sort-btns {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 4px;
  }

  .mobile-court-row .sort-btns button,
  .mobile-wait-row .sort-btns button {
    max-width: 100%;
    font-size: 14px;
    padding: 4px 6px;
    box-sizing: border-box;
  }
}
</style>

<!-- Firebase App (the core Firebase SDK) -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
</script>
</head>
<body>
<h2>배드민턴 코트 배정</h2>
<textarea id="inputArea" placeholder="이름 급수 성별 입력"></textarea>
<button class="btn" id="generateBtn" style="font-size: 20px;">이름표 만들기</button>
<div class="layout"><div class="column" id="wait1">
<div class="header">
<h4 style="font-size: 24px;">대기 1</h4><button class="reset-btn" onclick="resetColumn('wait1')" style="font-size: 18px;">리셋</button>
</div>
<div class="sort-btns">
<button class="reset-btn" onclick="moveAll('wait1','court1')" style="font-size: 18px;">1코트</button>
<button class="reset-btn" onclick="moveAll('wait1','court2')" style="font-size: 18px;">2코트</button>
<button class="reset-btn" onclick="moveAll('wait1','court3')" style="font-size: 18px;">3코트</button>
<button class="reset-btn" onclick="moveAll('wait1','court4')" style="font-size: 18px;">4코트</button>
</div>
</div><div class="column" id="wait2">
<div class="header">
<h4 style="font-size: 24px;">대기 2</h4><button class="reset-btn" onclick="resetColumn('wait2')" style="font-size: 18px;">리셋</button>
</div>
<div class="sort-btns"><button class="reset-btn" onclick="moveAll('wait2','wait1')" style="font-size: 18px;">대기1</button><button class="reset-btn" onclick="moveAll('wait2','court1')" style="font-size: 18px;">1코트</button><button class="reset-btn" onclick="moveAll('wait2','court2')" style="font-size: 18px;">2코트</button><button class="reset-btn" onclick="moveAll('wait2','court3')" style="font-size: 18px;">3코트</button><button class="reset-btn" onclick="moveAll('wait2','court4')" style="font-size: 18px;">4코트</button></div>
</div><div class="column" id="court1"><div class="header"><h4 style="font-size: 24px;">1코트</h4><button class="reset-btn" onclick="resetColumn('court1')" style="font-size: 18px;">리셋</button><button class="reset-btn" onclick="endCourt('court1')" style="font-size: 18px;">종료</button></div></div><div class="column" id="court2"><div class="header"><h4 style="font-size: 24px;">2코트</h4><button class="reset-btn" onclick="resetColumn('court2')" style="font-size: 18px;">리셋</button><button class="reset-btn" onclick="endCourt('court2')" style="font-size: 18px;">종료</button></div></div><div class="column" id="court3"><div class="header"><h4 style="font-size: 24px;">3코트</h4><button class="reset-btn" onclick="resetColumn('court3')" style="font-size: 18px;">리셋</button><button class="reset-btn" onclick="endCourt('court3')" style="font-size: 18px;">종료</button></div></div><div class="column" id="court4"><div class="header"><h4 style="font-size: 24px;">4코트</h4><button class="reset-btn" onclick="resetColumn('court4')" style="font-size: 18px;">리셋</button><button class="reset-btn" onclick="endCourt('court4')" style="font-size: 18px;">종료</button></div></div><div class="mobile-court-row"><div class="column" id="court1"><div class="header"><h4 style="font-size: 24px;">1코트</h4><button class="reset-btn" onclick="resetColumn('court1')" style="font-size: 18px;">리셋</button><button class="reset-btn" onclick="endCourt('court1')" style="font-size: 18px;">종료</button></div></div><div class="column" id="court2"><div class="header"><h4 style="font-size: 24px;">2코트</h4><button class="reset-btn" onclick="resetColumn('court2')" style="font-size: 18px;">리셋</button><button class="reset-btn" onclick="endCourt('court2')" style="font-size: 18px;">종료</button></div></div><div class="column" id="court3"><div class="header"><h4 style="font-size: 24px;">3코트</h4><button class="reset-btn" onclick="resetColumn('court3')" style="font-size: 18px;">리셋</button><button class="reset-btn" onclick="endCourt('court3')" style="font-size: 18px;">종료</button></div></div><div class="column" id="court4"><div class="header"><h4 style="font-size: 24px;">4코트</h4><button class="reset-btn" onclick="resetColumn('court4')" style="font-size: 18px;">리셋</button><button class="reset-btn" onclick="endCourt('court4')" style="font-size: 18px;">종료</button></div></div></div><div class="mobile-wait-row"><div class="column" id="wait1">
<div class="header">
<h4 style="font-size: 24px;">대기 1</h4><button class="reset-btn" onclick="resetColumn('wait1')" style="font-size: 18px;">리셋</button>
</div>
<div class="sort-btns">
<button class="reset-btn" onclick="moveAll('wait1','court1')" style="font-size: 18px;">1코트</button>
<button class="reset-btn" onclick="moveAll('wait1','court2')" style="font-size: 18px;">2코트</button>
<button class="reset-btn" onclick="moveAll('wait1','court3')" style="font-size: 18px;">3코트</button>
<button class="reset-btn" onclick="moveAll('wait1','court4')" style="font-size: 18px;">4코트</button>
</div>
</div><div class="column" id="wait2">
<div class="header">
<h4 style="font-size: 24px;">대기 2</h4><button class="reset-btn" onclick="resetColumn('wait2')" style="font-size: 18px;">리셋</button>
</div>
<div class="sort-btns"><button class="reset-btn" onclick="moveAll('wait2','wait1')" style="font-size: 18px;">대기1</button><button class="reset-btn" onclick="moveAll('wait2','court1')" style="font-size: 18px;">1코트</button><button class="reset-btn" onclick="moveAll('wait2','court2')" style="font-size: 18px;">2코트</button><button class="reset-btn" onclick="moveAll('wait2','court3')" style="font-size: 18px;">3코트</button><button class="reset-btn" onclick="moveAll('wait2','court4')" style="font-size: 18px;">4코트</button></div>
</div></div></div><div class="namepool-row"><div class="column" id="namePool">
<div class="header"><h4 style="font-size: 24px;">대기</h4></div>
<div class="sort-btns">
<button class="reset-btn" onclick="resetAll()" style="font-size: 18px;">초기화</button>
<button class="reset-btn" onclick="sortNamePool('급수정렬')" style="font-size: 18px;">급수정렬</button>
<button class="reset-btn" onclick="sortNamePool('횟수정렬')" style="font-size: 18px;">횟수정렬</button>
</div>
</div></div>
<script>
    function createTag(key, data) {
      const tag = document.createElement("div");
      tag.className = "name-tag";
      tag.dataset.key = key;
      tag.textContent = data.name + " " + data.level;
      tag.classList.add(data.gender === "남" ? "male" : "female");

      const badge = document.createElement("div");
      badge.className = "badge";
      badge.textContent = "0";
      badge.ondblclick = () => editBadge(badge);
      tag.appendChild(badge);

      tag.addEventListener("contextmenu", e => {
        e.preventDefault();
        tag.remove();
      });

      tag.addEventListener("touchend", function(e) {
        if (!tag.dataset.lastTouch || Date.now() - tag.dataset.lastTouch > 400) {
          tag.dataset.lastTouch = Date.now();
        } else {
          tag.remove();
          tag.dataset.lastTouch = 0;
        }
      });

      return tag;
    }

    function generateTags() {
      const input = document.getElementById("inputArea").value.trim();
      const lines = input.split("\n");
      lines.forEach(line => {
        const parts = line.trim().split(" ");
        if (parts.length >= 3) {
          const name = parts[0];
          const level = parts[1];
          const gender = parts[2];
          const tag = createTag(name + Date.now(), { name: name.toUpperCase(), level: level.toUpperCase(), gender: gender.toUpperCase() });
          document.getElementById("namePool").appendChild(tag);
        }
      });
      document.getElementById("inputArea").value = "";
    }

    function editBadge(badgeEl) {
      const oldValue = badgeEl.textContent;
      const input = document.createElement("input");
      input.type = "number";
      input.value = oldValue;
      input.style.width = "20px";
      badgeEl.textContent = "";
      badgeEl.appendChild(input);
      input.focus();
      input.onblur = () => {
        const val = parseInt(input.value, 10);
        badgeEl.textContent = isNaN(val) ? oldValue : val;
      };
      input.onkeydown = (e) => { if (e.key === "Enter") input.blur(); };
    }

    
function resetColumn(id) {
  const col = document.getElementById(id);
  const pool = document.getElementById("namePool");
  col.querySelectorAll(".name-tag").forEach(tag => pool.appendChild(tag));
}


    function endCourt(id) {
      const col = document.getElementById(id);
      const tags = col.querySelectorAll(".name-tag");
      tags.forEach(tag => {
        const badge = tag.querySelector(".badge");
        if (badge) badge.textContent = parseInt(badge.textContent) + 1;
        else {
          const newBadge = document.createElement("div");
          newBadge.className = "badge";
          newBadge.textContent = "1";
          newBadge.ondblclick = () => editBadge(newBadge);
          tag.appendChild(newBadge);
        }
        document.getElementById("namePool").appendChild(tag);
      });
    }

    function sortNamePool(type) {
      const pool = document.getElementById("namePool");
      const tags = Array.from(pool.querySelectorAll(".name-tag"));
      tags.sort((a, b) => {
        if (type === "급수정렬") {
      const order = { "S": 0, "A": 1, "B": 2, "C": 3, "D": 4 };
      const aLevel = a.textContent.trim().split(" ")[1].charAt(0).toUpperCase();
      const bLevel = b.textContent.trim().split(" ")[1].charAt(0).toUpperCase();
      return (order[aLevel] ?? 99) - (order[bLevel] ?? 99);
    }
        if (type === "횟수정렬") {
          const aCount = parseInt(a.querySelector(".badge")?.textContent || 0);
          const bCount = parseInt(b.querySelector(".badge")?.textContent || 0);
          return aCount - bCount;
        }
        return 0;
      });
      tags.forEach(tag => pool.appendChild(tag));
    }

    window.onload = () => {
      document.getElementById("generateBtn").onclick = generateTags;
      document.getElementById("inputArea").addEventListener("keydown", e => {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          generateTags();
        }
      });

      const ids = ["wait1", "wait2", "court1", "court2", "court3", "court4", "namePool"];
      ids.forEach(id => {
        new Sortable(document.getElementById(id), {
  draggable: ".name-tag",
          group: "shared",
          animation: 150
        });
      });
    };
  
function moveAll(fromId, toId) {
  const from = document.getElementById(fromId);
  const to = document.getElementById(toId);
  from.querySelectorAll('.name-tag').forEach(tag => to.appendChild(tag));
}

function resetAll() {
  const ids = ["wait1", "wait2", "court1", "court2", "court3", "court4", "namePool"];
  ids.forEach(id => {
    const col = document.getElementById(id);
    col.querySelectorAll(".name-tag").forEach(tag => tag.remove());
  });
}</script>
<script>
  function applyBodyZoomAndFit() {
    const designWidth = 1920;
    const designHeight = 1080;
    const scaleX = window.innerWidth / designWidth;
    const scaleY = window.innerHeight / designHeight;
    const scale = Math.min(scaleX, scaleY);
    document.body.style.zoom = scale;

    // namePool 높이 자동 조정
    const h2 = document.querySelector("h2")?.offsetHeight || 0;
    const textarea = document.querySelector("textarea")?.offsetHeight || 0;
    const button = document.querySelector(".btn")?.offsetHeight || 0;
    const layout = document.querySelector(".layout")?.offsetHeight || 0;
    const totalUsed = h2 + textarea + button + layout + 40; // 여유 margin 포함
    const available = window.innerHeight - totalUsed;

    const namePool = document.getElementById("namePool");
    if (namePool) {
      namePool.style.height = available + "px";
    }
  }

  window.addEventListener("resize", applyBodyZoomAndFit);
  window.addEventListener("load", applyBodyZoomAndFit);
</script>

<script>
// Firebase 실시간 동기화 기능

const columnIds = ["namePool", "wait1", "wait2", "court1", "court2", "court3", "court4"];

// 이름표 상태를 Firebase에 저장
function syncToFirebase() {
  const data = {};
  columnIds.forEach(id => {
    const column = document.getElementById(id);
    const tags = Array.from(column.querySelectorAll(".name-tag")).map(tag => {
      return {
        key: tag.dataset.key,
        name: tag.textContent.replace(/\s[SA-DF]\s*\d*$/, ""),
        level: tag.textContent.split(" ")[1],
        gender: tag.classList.contains("male") ? "남" : "여",
        badge: tag.querySelector(".badge")?.textContent || "0"
      };
    });
    data[id] = tags;
  });
  db.ref("tags").set(data);
}

// Firebase 데이터로 UI 업데이트
function loadFromFirebase() {
  db.ref("tags").on("value", snapshot => {
    const data = snapshot.val();
    if (!data) return;
    columnIds.forEach(id => {
      const col = document.getElementById(id);
      col.innerHTML = "";
      if (data[id]) {
        data[id].forEach(tag => {
          const tagEl = createTag(tag.key, tag);
          tagEl.querySelector(".badge").textContent = tag.badge;
          col.appendChild(tagEl);
        });
      }
    });
  });
}

// 이벤트 후 동기화
function observeMutationAndSync() {
  const config = { childList: true, subtree: true };
  const observer = new MutationObserver(() => {
    syncToFirebase();
  });
  columnIds.forEach(id => {
    const target = document.getElementById(id);
    observer.observe(target, config);
  });
}

window.addEventListener("load", () => {
  loadFromFirebase();
  observeMutationAndSync();
});
</script>
</body>
</html>
