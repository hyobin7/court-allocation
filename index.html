
<!DOCTYPE html>
<html>
<head><meta charset="utf-8"><title>Flicker Fixed</title></head>
<body><div id="namePool"></div><script>
  function createTag(key, data) {
    const tag = document.createElement("div");
    tag.className = "name-tag";
    tag.dataset.key = key;
    tag.textContent = data.name + " " + data.level;
    return tag;
  }
</script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
  const app = initializeApp({apiKey:"AIza...fake", databaseURL:"https://example.firebaseio.com"});
  const db = getDatabase(app);
  const poolIds = ["namePool"];
  const rootRef = ref(db, 'players');
  onValue(rootRef, (snapshot) => {
    const players = snapshot.val() || {};
    const currentTags = document.querySelectorAll(".name-tag");
    const currentKeys = new Set();
    currentTags.forEach(tag => currentKeys.add(tag.dataset.key));
    const newKeys = new Set(Object.keys(players));
    currentTags.forEach(tag => {
      const key = tag.dataset.key;
      if (!newKeys.has(key)) tag.remove();
    });
    for (let key in players) {
      const data = players[key];
      let existing = document.querySelector(`.name-tag[data-key="${key}"]`);
      const parent = document.getElementById(data.location);
      if (existing) {
        if (existing.parentElement !== parent) parent.appendChild(existing);
      } else {
        const tag = createTag(key, data);
        parent.appendChild(tag);
      }
    }
  });
</script></body>
</html>
