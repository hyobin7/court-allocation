<!DOCTYPE html>
<html lang="ko"><head><meta charset="utf-8"/><title>배드민턴 코트 배정</title><meta content="width=device-width, initial-scale=1" name="viewport"/><script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script><script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script><style>
body { font-family: Arial; background: #f0f8ff; padding: 20px; }
textarea { width: 100%; height: 80px; margin-bottom: 10px; }
.btn, .reset-btn { padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; margin: 4px; font-size: 14px; }
.btn { background-color: #007bff; color: white; }
.reset-btn { background-color: #ff6666; color: white; }
.column { border: 2px solid #ccc; border-radius: 6px; padding: 10px; margin-bottom: 10px; background: white; min-height: 100px; }
.name-tag { padding: 6px; margin: 5px; background: #ddd; border-radius: 4px; display: inline-block; position: relative; font-weight: bold; }
.male { background-color: #cce5ff; border: 1px solid #3399ff; }
.female { background-color: #ffd6e8; border: 1px solid #ff66b2; }
.badge { position: absolute; top: 2px; left: 4px; background-color: #800020; color: white; border-radius: 10px; padding: 2px 6px; font-size: 12px; }
.flex { display: flex; gap: 10px; flex-wrap: wrap; }
</style></head><body>
<h2>배드민턴 코트 배정</h2>
<textarea id="inputArea" placeholder="예시: kim hyunsoo 3급 남\nlee jiyeon 2급 여"></textarea>
<button class="btn" id="generateBtn">이름표 만들기</button>
<div class="flex">
<div class="column" id="wait1">
<h3>대기 1</h3>
<button class="reset-btn" onclick="resetToWait('wait1')">리셋</button>
<button class="reset-btn" onclick="moveAllToCourt('wait1','court1')">1코트</button>
<button class="reset-btn" onclick="moveAllToCourt('wait1','court2')">2코트</button>
<button class="reset-btn" onclick="moveAllToCourt('wait1','court3')">3코트</button>
</div>
<div class="column" id="wait2">
<h3>대기 2</h3>
<button class="reset-btn" onclick="resetToWait('wait2')">리셋</button>
<button class="reset-btn" onclick="moveAllToCourt('wait2','court1')">1코트</button>
<button class="reset-btn" onclick="moveAllToCourt('wait2','court2')">2코트</button>
<button class="reset-btn" onclick="moveAllToCourt('wait2','court3')">3코트</button>
</div>
<div class="column" id="namePool">
<h3>대기</h3>
<button class="reset-btn" onclick="sortByLevel()">급수정렬</button>
<button class="reset-btn" onclick="sortByCount()">횟수정렬</button>
</div>
<div class="column" id="court1"><h3>1코트</h3><button class="reset-btn" onclick="resetCourt('court1')">리셋</button><button class="reset-btn" onclick="endCourt('court1')">종료</button></div>
<div class="column" id="court2"><h3>2코트</h3><button class="reset-btn" onclick="resetCourt('court2')">리셋</button><button class="reset-btn" onclick="endCourt('court2')">종료</button></div>
<div class="column" id="court3"><h3>3코트</h3><button class="reset-btn" onclick="resetCourt('court3')">리셋</button><button class="reset-btn" onclick="endCourt('court3')">종료</button></div>
</div>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const firebaseConfig = {
    apiKey: "AIzaSyBQnSbBwJR-IS1aOuNrJz4qopK3RSiZbGY",
    authDomain: "cock-5c32d.firebaseapp.com",
    databaseURL: "https://cock-5c32d-default-rtdb.firebaseio.com",
    projectId: "cock-5c32d",
    storageBucket: "cock-5c32d.appspot.com",
    messagingSenderId: "639370966543",
    appId: "1:639370966543:web:84bdc6f474a7ba8cbc557a"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const tagRefs = {};

  function createTag(key, data) {
    if (tagRefs[key]) return;
    const tag = document.createElement("div");
    tag.className = "name-tag";
    tag.dataset.key = key;
    tag.textContent = data.name + " " + data.level;
    tag.classList.add(data.gender === "남" ? "male" : "female");
    const badge = document.createElement("span");
    badge.className = "badge";
    badge.textContent = "0";
    badge.ondblclick = function () {
      const input = document.createElement("input");
      input.type = "number";
      input.value = badge.textContent;
      badge.innerHTML = "";
      badge.appendChild(input);
      input.focus();
      input.onblur = () => badge.textContent = input.value || "0";
    };
    tag.insertBefore(badge, tag.firstChild);
    tagRefs[key] = tag;
    tag.addEventListener("contextmenu", e => {
      e.preventDefault();
      if (confirm("이 이름표를 삭제할까요?")) db.ref("nameTags/" + key).remove();
    });
    tag.addEventListener("touchend", function(e) {
      if (!tag.dataset.lastTouch || Date.now() - tag.dataset.lastTouch > 400) {
        tag.dataset.lastTouch = Date.now();
      } else {
        db.ref("nameTags/" + key).remove();
        tag.dataset.lastTouch = 0;
      }
    });
    return tag;
  }

  function generateTags() {
    const input = document.getElementById("inputArea").value.trim();
    const lines = input.split("\n");
    lines.forEach(line => {
      const [name, level, gender] = line.trim().split(" ");
      if (name && level && gender) {
        db.ref("nameTags").push({ name, level, gender, court: "namePool" });
      }
    });
    document.getElementById("inputArea").value = "";
  }

  document.getElementById("generateBtn").onclick = generateTags;
  document.getElementById("inputArea").addEventListener("keydown", e => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      generateTags();
    }
  });

  db.ref("nameTags").on("child_added", snap => {
    const key = snap.key, data = snap.val();
    const tag = createTag(key, data);
    if (tag) document.getElementById(data.court || "namePool").appendChild(tag);
  });
  db.ref("nameTags").on("child_removed", snap => {
    const tag = tagRefs[snap.key];
    if (tag) tag.remove();
    delete tagRefs[snap.key];
  });
  db.ref("nameTags").on("child_changed", snap => {
    const tag = tagRefs[snap.key];
    const data = snap.val();
    if (tag) document.getElementById(data.court || "namePool").appendChild(tag);
  });

  window.resetToWait = function(id) {
    Object.entries(tagRefs).forEach(([key, el]) => {
      if (el.parentElement.id === id) db.ref("nameTags/" + key).update({ court: "namePool" });
    });
  };
  window.resetCourt = window.resetToWait;
  window.moveAllToCourt = function(from, to) {
    const tags = document.getElementById(from).querySelectorAll(".name-tag");
    let count = document.getElementById(to).querySelectorAll(".name-tag").length;
    tags.forEach(tag => {
      if (["court1","court2","court3"].includes(to) && count >= 4) return;
      db.ref("nameTags/" + tag.dataset.key).update({ court: to });
      count++;
    });
  };
  window.endCourt = function(courtId) {
    const tags = document.getElementById(courtId).querySelectorAll(".name-tag");
    tags.forEach(tag => {
      db.ref("nameTags/" + tag.dataset.key).update({ court: "namePool" });
      const badge = tag.querySelector(".badge");
      badge.textContent = parseInt(badge.textContent || "0") + 1;
    });
  };
  window.sortByLevel = function() {
    const tags = [...document.getElementById("namePool").querySelectorAll(".name-tag")];
    tags.sort((a, b) => a.textContent.split(" ")[1].localeCompare(b.textContent.split(" ")[1]));
    tags.forEach(tag => document.getElementById("namePool").appendChild(tag));
  };
  window.sortByCount = function() {
    const tags = [...document.getElementById("namePool").querySelectorAll(".name-tag")];
    tags.sort((a, b) => parseInt(b.querySelector(".badge").textContent || 0) - parseInt(a.querySelector(".badge").textContent || 0));
    tags.forEach(tag => document.getElementById("namePool").appendChild(tag));
  };

  ["wait1", "wait2", "namePool", "court1", "court2", "court3"].forEach(id => {
    new Sortable(document.getElementById(id), {
      group: "shared",
      animation: 150,
      onAdd: evt => {
        const tag = evt.item;
        const court = evt.to.id;
        if (["court1","court2","court3"].includes(court) &&
            evt.to.querySelectorAll(".name-tag").length > 4) {
          evt.from.appendChild(tag);
          alert("각 칸에는 최대 4명까지 가능합니다.");
          return;
        }
        db.ref("nameTags/" + tag.dataset.key).update({ court });
      }
    });
  });
});
</script></body></html>