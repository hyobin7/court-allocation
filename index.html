
<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>ë°°ë“œë¯¼í„´ ì½”íŠ¸ ë°°ì •</title>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js">
function moveAll(fromId, toId) {
  const from = document.getElementById(fromId);
  const to = document.getElementById(toId);
  from.querySelectorAll('.name-tag').forEach(tag => to.appendChild(tag));
}

function resetAll() {
  const ids = ["wait1", "wait2", "court1", "court2", "court3", "court4", "namePool"];
  ids.forEach(id => {
    const col = document.getElementById(id);
    col.querySelectorAll(".name-tag").forEach(tag => tag.remove());
  });
}
</script>
<style>
    body { font-family: Arial, sans-serif; background: #f0f8ff; padding: 1em; }
    h2 { text-align: center; }
    textarea { width: 100%; height: 100px; font-size: 16px; margin-bottom: 1em; }
    .btn { width: 100%; padding: 12px; background-color: #007bff; color: white; font-size: 16px; border: none; border-radius: 8px; margin-bottom: 20px; cursor: pointer; }
    .layout { display: flex; flex-wrap: wrap; gap: 10px; justify-content: space-between; }
    .column { background: white; border: 2px solid #ccc; border-radius: 8px; padding: 10px; flex: 1; min-width: 200px; min-height: 150px; position: relative; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
    .reset-btn { background: #ff6666; color: white; border: none; padding: 4px 8px; border-radius: 5px; font-size: 12px; cursor: pointer; }
    .name-tag {
    font-size: 20px;
    padding: 10px 12px;
    line-height: 24px;
    min-height: 32px; display: inline-block; margin: 5px; padding: 8px 10px; border: 2px solid #444; border-radius: 6px; font-size: 14px; font-weight: bold; background: #ffffcc; position: relative; }
    .male { background-color: #cce5ff; border-color: #3399ff; }
    .female { background-color: #ffd6e8; border-color: #ff66b2; }
    


.badge {
  position: absolute;
  top: -0.5em;
  left: -0.5em;
  background: #800020;
  color: white;
  font-size: 0.8em;
  width: 1.5em;
  height: 1.5em;
  line-height: 1.5em;
  border-radius: 50%;
  text-align: center;
  z-index: 10;
  cursor: pointer;
}



    .sort-btns { display: flex; gap: 5px; margin-top: 5px; }
  
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: nowrap;
  gap: 10px;
}
.header h4 {
  margin: 0;
  white-space: nowrap;
}

.layout {
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  flex-wrap: nowrap;
  overflow-x: auto;
}
.layout > div {
  flex: 1 0 auto;
  margin: 5px;
}

.namepool-row {
  display: flex;
  justify-content: center;
  margin-top: 20px;
}
#namePool {
  width: 95%;
}

#wait1, #wait2 {
  flex: 0 0 18%;
  min-width: 200px;
  flex: 0 0 16%;
  min-width: 180px;
}
#wait2 .sort-btns {
  display: flex;
  gap: 5px;
  margin-top: 5px;
}
#wait2 .sort-btns button {
  white-space: nowrap;
}

.name-tag 


.badge {
  position: absolute;
  top: -0.5em;
  left: -0.5em;
  background: #800020;
  color: white;
  font-size: 0.8em;
  width: 1.5em;
  height: 1.5em;
  line-height: 1.5em;
  border-radius: 50%;
  text-align: center;
  z-index: 10;
  cursor: pointer;
}



.name-tag {
    font-size: 20px;
    padding: 10px 12px;
    line-height: 24px;
    min-height: 32px;
  position: relative;
  padding-left: 10px;
  padding-top: 10px;
}
</style>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
</head>
<body>
<h2>ë°°ë“œë¯¼í„´ ì½”íŠ¸ ë°°ì •</h2>
<textarea id="inputArea" placeholder="ì´ë¦„ ê¸‰ìˆ˜ ì„±ë³„ ì…ë ¥"></textarea>

<div style="margin-top:6px;font-size:12px;color:#555;">
ì…ë ¥í˜•ì‹: ì´ë¦„ ê¸‰ìˆ˜ [ê·¸ë£¹] ì„±ë³„ (ê·¸ë£¹ ìƒëµ ê°€ëŠ¥)
</div>
<div style="margin-top:6px;">
  <input type="file" id="excelUpload" accept=".xlsx,.xls">
  <button id="excelCreateBtn">ì—‘ì…€ë¡œ ì´ë¦„í‘œ ë§Œë“¤ê¸°</button>
</div>

<button class="btn" id="generateBtn" style="font-size: 20px;">ì´ë¦„í‘œ ë§Œë“¤ê¸°</button>
<div class="layout"><div class="column" id="wait1">
<div class="header">
<h4 style="font-size: 24px;">ëŒ€ê¸° 1</h4><button class="reset-btn" onclick="resetColumn('wait1')" style="font-size: 18px;">ë¦¬ì…‹</button>
</div>
<div class="sort-btns" style="display: flex; flex-wrap: wrap; gap: 5px; margin-top: 5px;">
<button class="reset-btn" onclick="moveAll('wait1','court1')" style="font-size: 18px;">1ì½”íŠ¸</button>
<button class="reset-btn" onclick="moveAll('wait1','court2')" style="font-size: 18px;">2ì½”íŠ¸</button>
<button class="reset-btn" onclick="moveAll('wait1','court3')" style="font-size: 18px;">3ì½”íŠ¸</button>
<button class="reset-btn" onclick="moveAll('wait1','court4')" style="font-size: 18px;">4ì½”íŠ¸</button>
</div>
</div><div class="column" id="wait2">
<div class="header">
<h4 style="font-size: 24px;">ëŒ€ê¸° 2</h4><button class="reset-btn" onclick="resetColumn('wait2')" style="font-size: 18px;">ë¦¬ì…‹</button>
</div>
<div class="sort-btns" style="display: flex; flex-wrap: wrap; gap: 5px; margin-top: 5px;"><button class="reset-btn" onclick="moveAll('wait2','wait1')" style="font-size: 18px;">ëŒ€ê¸°1</button><button class="reset-btn" onclick="moveAll('wait2','court1')" style="font-size: 18px;">1ì½”íŠ¸</button><button class="reset-btn" onclick="moveAll('wait2','court2')" style="font-size: 18px;">2ì½”íŠ¸</button><button class="reset-btn" onclick="moveAll('wait2','court3')" style="font-size: 18px;">3ì½”íŠ¸</button><button class="reset-btn" onclick="moveAll('wait2','court4')" style="font-size: 18px;">4ì½”íŠ¸</button></div>
</div><div class="column" id="court1"><div class="header"><h4 style="font-size: 24px;">1ì½”íŠ¸</h4><button class="reset-btn" onclick="resetColumn('court1')" style="font-size: 18px;">ë¦¬ì…‹</button><button class="reset-btn" onclick="endCourt('court1')" style="font-size: 18px;">ì¢…ë£Œ</button></div></div><div class="column" id="court2"><div class="header"><h4 style="font-size: 24px;">2ì½”íŠ¸</h4><button class="reset-btn" onclick="resetColumn('court2')" style="font-size: 18px;">ë¦¬ì…‹</button><button class="reset-btn" onclick="endCourt('court2')" style="font-size: 18px;">ì¢…ë£Œ</button></div></div><div class="column" id="court3"><div class="header"><h4 style="font-size: 24px;">3ì½”íŠ¸</h4><button class="reset-btn" onclick="resetColumn('court3')" style="font-size: 18px;">ë¦¬ì…‹</button><button class="reset-btn" onclick="endCourt('court3')" style="font-size: 18px;">ì¢…ë£Œ</button></div></div><div class="column" id="court4"><div class="header"><h4 style="font-size: 24px;">4ì½”íŠ¸</h4><button class="reset-btn" onclick="resetColumn('court4')" style="font-size: 18px;">ë¦¬ì…‹</button><button class="reset-btn" onclick="endCourt('court4')" style="font-size: 18px;">ì¢…ë£Œ</button></div></div></div><div class="namepool-row"><div class="column" id="namePool">
<div class="header"><h4 style="font-size: 24px;">ëŒ€ê¸°</h4></div>
<div class="sort-btns">
<button class="reset-btn" onclick="resetAll()" style="font-size: 18px;">ì´ˆê¸°í™”</button>
<button class="reset-btn" onclick="sortNamePool('ê¸‰ìˆ˜ì •ë ¬')" style="font-size: 18px;">ê¸‰ìˆ˜ì •ë ¬</button>
<button class="reset-btn" onclick="sortNamePool('íšŸìˆ˜ì •ë ¬')" style="font-size: 18px;">íšŸìˆ˜ì •ë ¬</button>
</div>
</div></div>
<script>
    function createTag(key, data) {
      const tag = document.createElement("div");
      tag.className = "name-tag";
      tag.dataset.key = key;
      tag.textContent = data.name + " " + data.level;
      tag.classList.add(data.gender === "ë‚¨" ? "male" : "female");

      const badge = document.createElement("div");
      badge.className = "badge";
      badge.textContent = "0";
      badge.ondblclick = () => editBadge(badge);
      tag.appendChild(badge);

      tag.addEventListener("contextmenu", e => {
        e.preventDefault();
        tag.remove();
      });

      tag.addEventListener("touchend", function(e) {
        if (!tag.dataset.lastTouch || Date.now() - tag.dataset.lastTouch > 400) {
          tag.dataset.lastTouch = Date.now();
        } else {
          tag.remove();
          tag.dataset.lastTouch = 0;
        }
      });

      return tag;
    }

    function generateTags() {
      const input = document.getElementById("inputArea").value.trim();
      const lines = input.split("\n");
      lines.forEach(line => {
        const parts = line.trim().split(" ");
        if (parts.length >= 3) {
          const name = parts[0];
          const level = parts[1];
          const gender = parts[2];
          const tag = createTag(name + Date.now(), { name: name.toUpperCase(), level: level.toUpperCase(), gender: gender.toUpperCase() });
          document.getElementById("namePool").appendChild(tag);
        }
      });
      document.getElementById("inputArea").value = "";
    }

    function editBadge(badgeEl) {
      const oldValue = badgeEl.textContent;
      const input = document.createElement("input");
      input.type = "number";
      input.value = oldValue;
      input.style.width = "20px";
      badgeEl.textContent = "";
      badgeEl.appendChild(input);
      input.focus();
      input.onblur = () => {
        const val = parseInt(input.value, 10);
        badgeEl.textContent = isNaN(val) ? oldValue : val;
      };
      input.onkeydown = (e) => { if (e.key === "Enter") input.blur(); };
    }

    
function resetColumn(id) {
  const col = document.getElementById(id);
  const pool = document.getElementById("namePool");
  col.querySelectorAll(".name-tag").forEach(tag => pool.appendChild(tag));
}


    function endCourt(id) {
      const col = document.getElementById(id);
      const tags = col.querySelectorAll(".name-tag");
      tags.forEach(tag => {
        const badge = tag.querySelector(".badge");
        if (badge) badge.textContent = parseInt(badge.textContent) + 1;
        else {
          const newBadge = document.createElement("div");
          newBadge.className = "badge";
          newBadge.textContent = "1";
          newBadge.ondblclick = () => editBadge(newBadge);
          tag.appendChild(newBadge);
        }
        document.getElementById("namePool").appendChild(tag);
      });
    }

    function sortNamePool(type) {
      const pool = document.getElementById("namePool");
      const tags = Array.from(pool.querySelectorAll(".name-tag"));
      tags.sort((a, b) => {
        if (type === "ê¸‰ìˆ˜ì •ë ¬") {
      const order = { "S": 0, "A": 1, "B": 2, "C": 3, "D": 4 };
      const aLevel = a.textContent.trim().split(" ")[1].charAt(0).toUpperCase();
      const bLevel = b.textContent.trim().split(" ")[1].charAt(0).toUpperCase();
      return (order[aLevel] ?? 99) - (order[bLevel] ?? 99);
    }
        if (type === "íšŸìˆ˜ì •ë ¬") {
          const aCount = parseInt(a.querySelector(".badge")?.textContent || 0);
          const bCount = parseInt(b.querySelector(".badge")?.textContent || 0);
          return aCount - bCount;
        }
        return 0;
      });
      tags.forEach(tag => pool.appendChild(tag));
    }

    window.onload = () => {
      document.getElementById("generateBtn").onclick = generateTags;
      document.getElementById("inputArea").addEventListener("keydown", e => {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          generateTags();
        }
      });

      const ids = ["wait1", "wait2", "court1", "court2", "court3", "court4", "namePool"];
      ids.forEach(id => {
        new Sortable(document.getElementById(id), {
  draggable: ".name-tag",
          group: "shared",
          animation: 150
        });
      });
    };
  
function moveAll(fromId, toId) {
  const from = document.getElementById(fromId);
  const to = document.getElementById(toId);
  from.querySelectorAll('.name-tag').forEach(tag => to.appendChild(tag));
}

function resetAll() {
  const ids = ["wait1", "wait2", "court1", "court2", "court3", "court4", "namePool"];
  ids.forEach(id => {
    const col = document.getElementById(id);
    col.querySelectorAll(".name-tag").forEach(tag => tag.remove());
  });
}</script>
<script>
  function applyBodyZoomAndFit() {
    const designWidth = 1920;
    const designHeight = 1080;
    const scaleX = window.innerWidth / designWidth;
    const scaleY = window.innerHeight / designHeight;
    const scale = Math.min(scaleX, scaleY);
    document.body.style.zoom = scale;

    // namePool ë†’ì´ ìë™ ì¡°ì •
    const h2 = document.querySelector("h2")?.offsetHeight || 0;
    const textarea = document.querySelector("textarea")?.offsetHeight || 0;
    const button = document.querySelector(".btn")?.offsetHeight || 0;
    const layout = document.querySelector(".layout")?.offsetHeight || 0;
    const totalUsed = h2 + textarea + button + layout + 40; // ì—¬ìœ  margin í¬í•¨
    const available = window.innerHeight - totalUsed;

    const namePool = document.getElementById("namePool");
    if (namePool) {
      namePool.style.height = available + "px";
    }
  }

  window.addEventListener("resize", applyBodyZoomAndFit);
  window.addEventListener("load", applyBodyZoomAndFit);
</script>
<script>
(function(){

  function normalizeGroup(group){
    if(!group) return '';
    return /^[a-zA-Z]+$/.test(group) ? group.toUpperCase() : group;
  }

  // ğŸ”¹ ìˆ˜ë™ ìƒì„± ë²„íŠ¼ ë¡œì§ ê°€ë¡œì±„ê¸° (ê¸°ì¡´ onclick ìœ ì§€)
  const oldHandler = window.createNameTagsFromInput;
  if (typeof oldHandler === 'function') {
    window.createNameTagsFromInput = function(){
      const inputEl = document.getElementById('nameInput');
      const text = inputEl.value.trim();
      if(!text) return;

      inputEl.value = '';

      text.split(/\n+/).forEach(line => {
        const parts = line.trim().split(/\s+/);
        if(parts.length < 3) return;

        const name = parts[0];
        const level = parts[1];
        const gender = parts[parts.length - 1];
        const group = parts.length === 4 ? normalizeGroup(parts[2]) : '';

        // ğŸ‘‰ ê¸°ì¤€ íŒŒì¼ì´ ì›ë˜ ì²˜ë¦¬í•˜ë˜ í˜•ì‹ìœ¼ë¡œ ë‹¤ì‹œ í•©ì³ì„œ ìœ„ì„
        const rebuilt = group
          ? `${name} ${level} ${gender} ${group}`
          : `${name} ${level} ${gender}`;

        oldHandler.call(this, rebuilt);
      });
    };
  }

  // ğŸ”¹ ì—‘ì…€ ì—…ë¡œë“œë„ "ìˆ˜ë™ ì…ë ¥ê³¼ ë™ì¼í•œ ê²½ë¡œ" ì‚¬ìš©
  document.addEventListener('DOMContentLoaded', function(){
    const btn = document.getElementById('excelCreateBtn');
    if(!btn) return;

    btn.addEventListener('click', function(){
      const fileInput = document.getElementById('excelUpload');
      const file = fileInput.files[0];
      if(!file){
        alert('ì—‘ì…€ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }

      if (typeof window.createNameTagsFromInput !== 'function') {
        alert('ìˆ˜ë™ ì´ë¦„í‘œ ìƒì„± í•¨ìˆ˜(createNameTagsFromInput)ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e){
        const wb = XLSX.read(new Uint8Array(e.target.result), { type:'array' });
        const sheet = wb.Sheets[wb.SheetNames[0]];
        const rows = XLSX.utils.sheet_to_json(sheet, { defval:'' });

        let lines = [];
        let s=0,f=0;

        rows.forEach(row => {
          const name = String(row['ì´ë¦„']||'').trim();
          const level = String(row['ê¸‰ìˆ˜']||'').trim();
          const gender = String(row['ì„±ë³„']||'').trim();
          const group = normalizeGroup(String(row['ê·¸ë£¹']||'').trim());

          if(!name || !level || !gender){ f++; return; }

          lines.push(group
            ? `${name} ${level} ${group} ${gender}`
            : `${name} ${level} ${gender}`
          );
          s++;
        });

        // textareaì— ë„£ê³  ê¸°ì¡´ ë¡œì§ í˜¸ì¶œ
        const inputEl = document.getElementById('nameInput');
        inputEl.value = lines.join('\n');
        window.createNameTagsFromInput();

        alert(`ì—‘ì…€ ì—…ë¡œë“œ ì™„ë£Œ\nì„±ê³µ: ${s}ëª… / ì‹¤íŒ¨: ${f}ëª…`);
        fileInput.value='';
      };

      reader.readAsArrayBuffer(file);
    });
  });

})();
</script>
</body>
</html>
